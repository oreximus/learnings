# External Pentesting

## Source: https://book.hacktricks.xyz/generic-methodologies-and-resources/external-recon-methodology

## Assets Discoveries

- What company actually owns.

- The goal of this phase is to obtain all the **companies owned by the main company** and then all the **assets** of these companies. To do so, we are going to:
    1. Find all the acquisions of the main company, this will give us the companies inside the scope.
    2. Find the ASN (Autonomous System Number) (if any) of each company, this will give us the IP ranges owned by each company.
    3. Use reverse whois lookups to search for other entries (organization names, domains...) related to the first one (this can be done recursively)
    4. Use other techniques like shodan `org` and `ssl` filters to search for other assets (the `ssl` trick can be done recursively).

## Acquisitions

- First of all, we need to know which **other companies are owned by the main company**.
- One option is to visit *https://www.crunchbase.com/*, **search** for the **main company**, and **click** on "**acquisions**". There you will see other companies acquired by the main one.
- Other option is to visit the **Wikipedia** page of the main company and search for **acquisitions**.

---
At this point we have all the companies in scope. Now it's time find the assets.
---

## ASNs

- An autonomous system number (**ASN**) is a **unique number** assigned to an **autonomous system** (AS) by the **Internet Assigned Numbers Authority (IANA)**.

- An **AS** consists of **blocks** of **IP addresses** which have a distinctly defined policy for accessing external networks and are administered by a single organization but may be made up of several operators.

- It's interesting to find the **company have assigned any ASN** to find its **IP ranges**. It will be interested to perform a **vulnerability test** against all the **hosts** inside the **scope** and **look for domains** inside these IPs. You can search company **name**, by **IP** or by **domain** in ***https://bgp.he.net/.***

- **Depending on the region the of the company this links could be useful to gather more data:
    - [AFRINIC](https://www.afrinic.net/) Africa
    - [Arin](https://www.arin.net/about/welcome/region/) North America
    - [APNIC](https://www.apnic.net/) Asia
    - [LACNIC](https://www.lacnic.net/) Latin America
    - [RIPE NCC](https://www.ripe.net/) Europe

---
You can also automate this amass, but it's not very recommended
---

- Alos [BBOT](https://github.com/blacklanternsecurity/bbot)'s Enumeration automatically aggregates and summarizes ASNs at the end of the scan.

```
bbot -t tesla.com -f subdomain-enum
```

- You can find the IP ranges of an organization also using ***http://asnlookups.com/*** (it has free API).

- You can fins the IP and ASN of a domain using ***http://ipv4info.com/***.

## Looking for Vulnerabilities

- At this point we known **all the assets inside the scope,*** so if you are allowed you could launce some **vulnerability scanner** (Nessus, OpenVAS) over all the hosts.

- Also, you could launce some **port scans** or use services like **shodan**.

- Also you can try with some default credentials to bruteforce services with ***https://github.com/x90skysn3k/brutespray***

## Domains

---
Now we have all the companies in the scope and their assets, let dig into the domains
---

- First of all take a look at the **main domain**(s) for each company. For example, for Tesla Inc. is going to be tesla.com.

## Reverse DNS

- As you have found all the IP ranges of the domains you could try to perform **reverse dns lookups** on those **IPs to find more domains inside the scope.**

- Try to use some dns sever of the victim of some well-known dns server (1.1.1.1, 8.8.8.8)

```
dnsrecon -r <DNS Range> -n <IP_DNS>   #DNS reverse of all of the addresses
dnsrecon -d facebook.com -r 157.240.221.35/24 #Using facebooks dns
dnsrecon -r 157.240.221.35/24 -n 1.1.1.1 #Using cloudflares dns
dnsrecon -r 157.240.221.35/24 -n 8.8.8.8 #Using google dns
```

- For this to work, the administrator has to enable manually the PTR. You can also use a online tool for this info: ***http://ptrarchive.com/***

## Reverse Whois (loop)

- Inside a **whois** you can find a lot of interesting **information** like **organization name, address, emails,** phone numbers,... 
